<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Cubic Graph Experiment Demo | Thomason Algorithm Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Cubic Graph Experiment Demo | Thomason Algorithm Documentation ">
    
    
      <link rel="shortcut icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../styles/docfx.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta property="docfx:navrel" content="../toc.html">
      <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="cubic-graph-experiment-demo">Cubic Graph Experiment Demo</h1>

<p><strong>See also</strong>:</p>
<ul>
<li><a href="getting-started.html">Getting Started</a></li>
<li><a href="./api/ThomasonAlgorithm.Core.Algorithm.html">API Reference</a></li>
</ul>
<h1 id="cubic-graph-experiment-demo-1">Cubic Graph Experiment Demo</h1>
<h2 id="overview">Overview</h2>
<p>This demonstration showcases how to use ThomasonAlgorithm.Core to:</p>
<ul>
<li>Generate random cubic graphs with specified constraints</li>
<li>Find Hamiltonian cycles using the Lollipop algorithm</li>
<li>Store and analyze experiment results in PostgreSQL</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>.NET 8+ SDK</li>
<li>PostgreSQL 14+ with JSONB support</li>
<li>NuGet packages:
<pre><code class="lang-bash">dotnet add package Npgsql
dotnet add package Microsoft.EntityFrameworkCore
dotnet add package ThomasonAlgorithm.Core

</code></pre>
</li>
</ul>
<h1 id="1-data-model-implementation">1. Data Model Implementation</h1>
<h2 id="11-entity-definition">1.1 Entity Definition</h2>
<pre><code class="lang-csharp">public sealed record CubicGraphExperiment
{
    public CubicGraphExperiment(int verticesNumber, int kLow, int kUp, int maxChordLength, int lollipopStepsNumber, Dictionary&lt;int, int&gt; chordLengths)
    {
        VerticesNumber = verticesNumber;
        KLow = kLow;
        KUp = kUp;
        MaxChordLength = maxChordLength;
        LollipopStepsNumber = lollipopStepsNumber;
        ChordLengths = chordLengths;
        Timestamp = DateTime.UtcNow;        
    }
    
    public Guid Id { get; set; } = Guid.NewGuid();
    
    /// &lt;summary&gt;
    /// number of vertex in graph
    /// &lt;/summary&gt;
    [Column(&quot;vertices_number&quot;)]
    public int VerticesNumber { get; set; }
    
    /// &lt;summary&gt;
    /// chord length lower limit 
    /// &lt;/summary&gt;
    [Column(&quot;K_low&quot;)]
    public int KLow { get; set; }
    
    /// &lt;summary&gt;
    /// chord length upper limit
    /// &lt;/summary&gt;
    [Column(&quot;K_up&quot;)]
    public int KUp { get; set; }
    
    /// &lt;summary&gt;
    /// biggest chord length in graph
    /// &lt;/summary&gt;
    [Column(&quot;max_chord_length&quot;)]
    public int MaxChordLength { get; set; }
    
    /// &lt;summary&gt;
    /// number of steps which algorithm required to find second hamiltonian cycle in presented graph
    /// &lt;/summary&gt;
    [Column(&quot;lollipop_steps_number&quot;)]
    public int LollipopStepsNumber { get; set; }

    /// &lt;summary&gt;
    /// chord lengths and its number which exist in graph
    /// &lt;/summary&gt;
    [Column(&quot;chord_lengths&quot;, TypeName = &quot;jsonb&quot;)]
    public Dictionary&lt;int, int&gt; ChordLengths { get; set; }
    
    [Column(&quot;timestamp&quot;)]
    public DateTime Timestamp { get; set; }
}
</code></pre>
<h2 id="12-database-context">1.2 Database Context</h2>
<pre><code class="lang-csharp">public class AppDbContext : DbContext
{
    public DbSet&lt;CubicGraphExperiment&gt; CubicGraphExperiments { get; set; } 
        
    public AppDbContext(DbContextOptions&lt;AppDbContext&gt; options) : base(options) { }
    
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);

        modelBuilder.Entity&lt;CubicGraphExperiment&gt;()
            .HasKey(e =&gt; e.Id);
        
        modelBuilder.Entity&lt;CubicGraphExperiment&gt;()
            .Property(x =&gt; x.ChordLengths)
            .HasColumnType(&quot;jsonb&quot;);
    } 
}
</code></pre>
<h1 id="2-infrastructure-setup">2. Infrastructure Setup</h1>
<h2 id="21-database-configuration">2.1 Database Configuration</h2>
<pre><code class="lang-csharp">public static class DependencyInjection
{
    public static IServiceCollection AddDbInfrastructure(this IServiceCollection services, string connectionString)
    {
        if (connectionString == null)
            throw new ArgumentNullException(nameof(connectionString), &quot;Connection string is required&quot;);

        var npgSqlDatasourceBuilder = new NpgsqlDataSourceBuilder(connectionString).EnableDynamicJson().Build();
        
        services.AddDbContext&lt;AppDbContext&gt;(options =&gt;
            options.UseNpgsql(npgSqlDatasourceBuilder).UseSnakeCaseNamingConvention());

        return services;
    }
}
</code></pre>
<h2 id="22-service-registration">2.2 Service Registration</h2>
<pre><code class="lang-csharp">// In Program.cs
builder.Services.AddDbInfrastructure(&quot;Host=localhost;Database=graph_db;Username=postgres;Password=your_password&quot;);
</code></pre>
<h1 id="3-experiment-configuration">3. Experiment Configuration</h1>
<h2 id="31-parameter-validation">3.1 Parameter Validation</h2>
<pre><code class="lang-csharp">public sealed record ExperimentOptions {
    public ExperimentOptions(
        int maxN,
        int kLow,
        int kUp,
        int maxAttempt = 100,
        int graphSameSize = 100,
        int startVerticesNumber = -1)
    {
        if (maxN &lt; 2 * kUp)
            throw new ArgumentOutOfRangeException(nameof(maxN), &quot;maxN must be greater than or equal to 2 * kUp&quot;);
        
        if (startVerticesNumber != -1 &amp;&amp; startVerticesNumber &lt; 2 * kUp)
            throw new ArgumentOutOfRangeException(nameof(startVerticesNumber), &quot;startVerticesNumber must be greater than or equal to 2 * kUp&quot;);
        
        if (startVerticesNumber != -1 &amp;&amp; startVerticesNumber % 2 != 0)
            throw new ArgumentOutOfRangeException(nameof(startVerticesNumber), &quot;startVerticesNumber must be even&quot;);
        
        if (maxN &lt; startVerticesNumber)
            throw new ArgumentOutOfRangeException(nameof(maxN), &quot;maxN must be greater than or equal to startVerticesNumber&quot;);
        
        if (kUp &lt; kLow)
            throw new ArgumentOutOfRangeException(nameof(kUp), &quot;kUp must be greater than or equal to kLow&quot;);
        
        if (maxAttempt &lt;= 0)
            throw new ArgumentOutOfRangeException(nameof(maxAttempt), &quot;maxAttempt must be greater than 0&quot;);
        
        if (graphSameSize &lt;= 0)
            throw new ArgumentOutOfRangeException(nameof(graphSameSize), &quot;graphSameSize must be greater than 0&quot;);

        MaxN = maxN;
        KLow = kLow;
        KUp = kUp;
        StartVerticesNumber = startVerticesNumber == -1 ? 2 * kUp : startVerticesNumber;
        MaxAttempt = maxAttempt;
        GraphSameSize = graphSameSize;
    }
    
    public void Deconstruct(
        out int maxN,
        out int kLow,
        out int kUp,
        out int startVerticesNumber,
        out int maxAttempt,
        out int graphSameSize)
    {
        maxN = MaxN;
        kLow = KLow;
        kUp = KUp;
        startVerticesNumber = StartVerticesNumber;
        maxAttempt = MaxAttempt;
        graphSameSize = GraphSameSize;
    }
    
    public int MaxN { get; init; }
    
    public int KLow { get; init; }
    
    public int KUp { get; init; }
    
    public int StartVerticesNumber { get; init; }
    
    public int MaxAttempt { get; init; }
    
    public int GraphSameSize { get; init; }
}
</code></pre>
<h1 id="4-core-experiment-service">4. Core Experiment Service</h1>
<h2 id="41-implementation">4.1 Implementation</h2>
<pre><code class="lang-csharp">public class CubicGraphExperimentService
{
    public async Task ExperimentCubicGraph(ExperimentOptions options, IHost app)
    {
        var (maxN, kLow, kUp, startVerticesNumber, maxAttempt, maxGraphsSameSize) = options;
        
        const int batchSize = 1000;
        const int initialStringBuilderCapacity = 256;

        var allExperiments = new List&lt;CubicGraphExperiment&gt;(batchSize);

        using var scope = app.Services.CreateScope();
        var dbContext = scope.ServiceProvider.GetRequiredService&lt;AppDbContext&gt;();

        for (var n = startVerticesNumber; n &lt;= maxN; n += 2)
        {
            var experiments = new List&lt;CubicGraphExperiment&gt;(maxGraphsSameSize);
            await Parallel.ForEachAsync(Enumerable.Range(0, maxGraphsSameSize), new ParallelOptions { MaxDegreeOfParallelism = Environment.ProcessorCount }, async (graphsSameSize, ct) =&gt;
            {
                var stringBuilder = new StringBuilder(initialStringBuilderCapacity);

                var randomCubicGraph = RandomCubicGraphGenerator.GenerateGraphLimitedChords(n, kLow, kUp, maxAttempt);

                if (randomCubicGraph == null)
                {
                    lock (Console.Out)
                    {
                        Console.WriteLine(&quot;Cubic graph was not generated.&quot;);
                    }
                    return;
                }

                var cubicGraphWithCycle = new CubicGraphWithCycle(randomCubicGraph);
                var lollipopStepsNumber = LollipopAlgorithm.FindSecondHamiltonianCycleAndReturnSteps(cubicGraphWithCycle);

                stringBuilder.AppendFormat(&quot;lollipop_steps_number: {0}, for graph with n: {1}, kLow: {2}, kUp: {3}&quot;, lollipopStepsNumber, n, kLow, kUp);
                lock (Console.Out)
                {
                    Console.WriteLine(stringBuilder.ToString());
                }
                stringBuilder.Clear();


                var experiment = new CubicGraphExperiment(n, kLow, kUp, randomCubicGraph.MaxChordLength, lollipopStepsNumber, randomCubicGraph.ChordsLengths);
                lock (experiments)
                {
                    experiments.Add(experiment);
                }
            });

            allExperiments.AddRange(experiments);

            if (allExperiments.Count &gt;= batchSize)
            {
                await dbContext.BulkInsertAsync(allExperiments);
                allExperiments.Clear();
            }
        }

        if (allExperiments.Any())
        {
            await dbContext.BulkInsertAsync(allExperiments);
        }
    }
}
</code></pre>
<h1 id="5-execution-example">5. Execution Example</h1>
<h2 id="running-the-experiment">Running the Experiment</h2>
<pre><code class="lang-csharp">var builder = WebApplication.CreateBuilder(args);
builder.Services.AddDbInfrastructure(builder.Configuration.GetConnectionString(&quot;Default&quot;));

var app = builder.Build();

// Configure experiment parameters
var options = new ExperimentOptions(
    maxN: 1000,
    kLow: 2,
    kUp: 10,
    maxAttempt: 100,
    graphSameSize: 500);

// Execute
var experimentService = new CubicGraphExperimentService();
await experimentService.RunExperiment(options, app);
</code></pre>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/DmitriiGoro/Thomason_algorithm_lollipop/blob/second-release/docs/articles/experiment-demo.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      © 2025 MIPT
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
